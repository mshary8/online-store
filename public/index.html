<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>ุงููุชุฌุฑ ุงูุฅููุชุฑููู</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="store-body">
    <!-- ููุฏุฑ -->
    <header class="store-header">
      <div class="store-logo">Meshari Tech Store</div>
      <nav class="store-nav">
        <a href="index.html">ุงูุฑุฆูุณูุฉ</a>
        <a href="login.html">ุชุณุฌูู ุงูุฏุฎูู</a>
        <a href="register.html">ุชุณุฌูู ุฌุฏูุฏ</a>
      </nav>
    </header>

    <!-- ุงููุญุชูู -->
    <div class="store-layout">
      <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (Sidebar) -->
      <aside class="store-sidebar">
        <h3 class="sidebar-title">ุงูุฃุตูุงู</h3>

        <button class="category-item active" data-category="all" data-group="all">
          ๐ ุนุฑุถ ุฌููุน ุงูููุชุฌุงุช
        </button>

        <div class="category-group">
          <div class="category-group-title group-electronics">
            โก ุงูุฅููุชุฑูููุงุช
          </div>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ูุงุจุชูุจุงุช"
            data-group="electronics"
          >
            ๐ป ูุงุจุชูุจุงุช
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุฌูุงูุงุช"
            data-group="electronics"
          >
            ๐ฑ ุงูุฌูุงูุงุช
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุณูุงุนุงุช"
            data-group="electronics"
          >
            ๐ง ุงูุณูุงุนุงุช
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุฃุฌูุฒุฉ ุชุฑููู (Sony / Xbox)"
            data-group="electronics"
          >
            ๐ฎ ุฃุฌูุฒุฉ ุงูุชุฑููู (Sony / Xbox)
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุดุงุดุงุช ุนุฑุถ"
            data-group="electronics"
          >
            ๐ฅ๏ธ ุดุงุดุงุช ุงูุนุฑุถ
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุณุงุนุงุช ุฐููุฉ"
            data-group="electronics"
          >
            โ ุงูุณุงุนุงุช ุงูุฐููุฉ
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ููุญุงุช ููุงุชูุญ ููุฃุฑุงุช"
            data-group="electronics"
          >
            โจ๏ธ ููุญุงุช ููุงุชูุญ / ูุฃุฑุงุช
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุฃุฌูุฒุฉ ุดุจูุฉ (ุฑุงูุชุฑ/ูุงู ูุงู)"
            data-group="electronics"
          >
            ๐ก ุฃุฌูุฒุฉ ุงูุดุจูุฉ (ุฑุงูุชุฑ/ูุงู ูุงู)
          </button>
          <button
            class="category-item"
            data-category="ุฅููุชุฑูููุงุช - ุฅูุณุณูุงุฑุงุช (ูุงุจูุงุช ูุญุงูุธุงุช)"
            data-group="electronics"
          >
            ๐ ุงูุฅูุณุณูุงุฑุงุช (ูุงุจูุงุช / ุญุงูุธุงุช)
          </button>
        </div>

        <div class="category-group">
          <div class="category-group-title group-subscriptions">
            ๐ฌ ุงูุงุดุชุฑุงูุงุช
          </div>
          <button
            class="category-item"
            data-category="ุงุดุชุฑุงูุงุช - ุชุทุจููุงุช ูุดุงูุฏุฉ"
            data-group="subscriptions"
          >
            ๐บ ุงุดุชุฑุงูุงุช ุชุทุจููุงุช ุงููุดุงูุฏุฉ
          </button>
        </div>
      </aside>

      <!-- ููุทูุฉ ุงูููุชุฌุงุช -->
      <main class="store-main">
        <!-- ุดุฑูุท ุงูููุงุชุฑ ุฃุนูู ุงูููุชุฌุงุช -->
        <section class="filters-bar">
          <div class="filters-left">
            <h2 id="productsTitle">ุฌููุน ุงูููุชุฌุงุช</h2>
            <span id="productsCount" class="products-count"></span>
          </div>
          <div class="filters-right">
            <input
              type="text"
              id="searchInput"
              placeholder="ุงุจุญุซ ุจุงุณู ุงูููุชุฌ ุฃู ุงููุตู..."
            />
            <input
              type="number"
              id="minPrice"
              placeholder="ุงูุณุนุฑ ูู"
              min="0"
            />
            <input
              type="number"
              id="maxPrice"
              placeholder="ุงูุณุนุฑ ุฅูู"
              min="0"
            />
            <button id="applyFiltersBtn">ุชุทุจูู ุงูููุชุฑ</button>
            <button id="resetFiltersBtn" class="secondary">
              ุฅุนุงุฏุฉ ุชุนููู
            </button>
          </div>
        </section>

        <div id="activeFilters" class="active-filters"></div>

        <div id="productsGrid" class="products-grid">
          <!-- ุงูููุชุฌุงุช ุชูุถุงู ููุง ุจุงูุฌุงูุงุณูุฑุจุช -->
        </div>
      </main>
    </div>

    <footer class="store-footer">
      &copy; <span id="year"></span> Meshari Tech Store โ ูุชุฌุฑ ุฅููุชุฑูููุงุช
      ูุงุดุชุฑุงูุงุช
    </footer>

    <script>
      const API_BASE = "";

      const productsGrid = document.getElementById("productsGrid");
      const productsTitle = document.getElementById("productsTitle");
      const productsCount = document.getElementById("productsCount");
      const sidebarButtons = document.querySelectorAll(".category-item");

      const searchInput = document.getElementById("searchInput");
      const minPriceInput = document.getElementById("minPrice");
      const maxPriceInput = document.getElementById("maxPrice");
      const applyFiltersBtn = document.getElementById("applyFiltersBtn");
      const resetFiltersBtn = document.getElementById("resetFiltersBtn");
      const activeFiltersBox = document.getElementById("activeFilters");

      let allProducts = [];
      let currentCategory = "all";
      let searchQuery = "";
      let minPrice = null;
      let maxPrice = null;

      function formatPrice(price) {
        return price.toLocaleString("ar-SA", {
          minimumFractionDigits: 0,
        });
      }

      function buildActiveFiltersLabel() {
        const parts = [];

        if (currentCategory !== "all") {
          parts.push("ุชุตููู: " + currentCategory);
        }
        if (searchQuery) {
          parts.push(`ุจุญุซ ุนู: "${searchQuery}"`);
        }
        if (minPrice !== null || maxPrice !== null) {
          const from = minPrice !== null ? minPrice : "โ";
          const to = maxPrice !== null ? maxPrice : "โ";
          parts.push(`ุงูุณุนุฑ ุจูู: ${from} โ ${to} ุฑ.ุณ`);
        }

        if (parts.length === 0) {
          activeFiltersBox.textContent = "";
          activeFiltersBox.style.display = "none";
        } else {
          activeFiltersBox.textContent = parts.join(" | ");
          activeFiltersBox.style.display = "block";
        }
      }

      function applyFilters() {
        let list = [...allProducts];

        // ุชุตููุฉ ุญุณุจ ุงูุชุตููู
        if (currentCategory !== "all") {
          list = list.filter((p) => p.category === currentCategory);
        }

        // ุชุตููุฉ ุญุณุจ ุงูุจุญุซ
        if (searchQuery) {
          const q = searchQuery.toLowerCase();
          list = list.filter((p) => {
            const name = (p.name || "").toLowerCase();
            const desc = (p.description || "").toLowerCase();
            const cat = (p.category || "").toLowerCase();
            return (
              name.includes(q) || desc.includes(q) || cat.includes(q)
            );
          });
        }

        // ุชุตููุฉ ุญุณุจ ุงูุณุนุฑ
        if (minPrice !== null) {
          list = list.filter((p) => Number(p.price) >= minPrice);
        }
        if (maxPrice !== null) {
          list = list.filter((p) => Number(p.price) <= maxPrice);
        }

        const label =
          currentCategory === "all" ? "ุฌููุน ุงูููุชุฌุงุช" : currentCategory;
        renderProducts(list, label);
        buildActiveFiltersLabel();
      }

      function renderProducts(list, categoryLabel) {
        productsGrid.innerHTML = "";

        if (!list || list.length === 0) {
          productsTitle.textContent = categoryLabel || "ุงูููุชุฌุงุช";
          productsCount.textContent = "";
          productsGrid.innerHTML =
            '<p class="empty-msg">ูุง ุชูุฌุฏ ููุชุฌุงุช ูุทุงุจูุฉ ููููุงุชุฑ ุงูุญุงููุฉ.</p>';
          return;
        }

        productsTitle.textContent =
          categoryLabel || "ุงูููุชุฌุงุช (" + list.length + ")";
        productsCount.textContent = list.length + " ููุชุฌ";

        list.forEach((p) => {
          const card = document.createElement("div");
          card.className = "product-card";

          card.innerHTML = `
            <div class="product-image">
              <div class="product-image-placeholder">
                ${p.name
                  .split(" ")
                  .slice(0, 2)
                  .join(" ")}
              </div>
            </div>
            <div class="product-content">
              <h3 class="product-name">${p.name}</h3>
              <p class="product-category">${p.category || ""}</p>
              <p class="product-desc">${p.description || ""}</p>
              <div class="product-footer">
                <span class="product-price">${formatPrice(
                  p.price
                )} ุฑ.ุณ</span>
                <button class="product-btn">ุฅุถุงูุฉ ููุณูุฉ</button>
              </div>
            </div>
          `;

          productsGrid.appendChild(card);
        });
      }

      async function loadProducts() {
        try {
          const res = await fetch(`${API_BASE}/api/products`);
          const data = await res.json();
          allProducts = data || [];
          applyFilters(); // ูุนุฑุถ ูู ุดูุก ูุจุฏุฆูุงู
        } catch (err) {
          console.error(err);
          productsGrid.innerHTML =
            '<p class="empty-msg">ุชุนุฐูุฑ ุชุญููู ุงูููุชุฌุงุช. ุชุฃูุฏ ุฃู ุงูุณูุฑูุฑ ูุนูู.</p>';
        }
      }

      // ุชุบููุฑ ุงูุชุตููู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
      sidebarButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          sidebarButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          currentCategory = btn.getAttribute("data-category") || "all";
          applyFilters();
        });
      });

      // ุจุญุซ ุจุงููููุฉ
      searchInput.addEventListener("input", () => {
        searchQuery = searchInput.value.trim();
      });

      // ุชุทุจูู ููุชุฑ ุงูุณุนุฑ + ุงูุจุญุซ (ุจุงูุฒุฑ)
      applyFiltersBtn.addEventListener("click", () => {
        const minVal = minPriceInput.value;
        const maxVal = maxPriceInput.value;

        minPrice = minVal !== "" ? Number(minVal) : null;
        maxPrice = maxVal !== "" ? Number(maxVal) : null;

        applyFilters();
      });

      // ุฅุนุงุฏุฉ ุชุนููู ูู ุงูููุงุชุฑ
      resetFiltersBtn.addEventListener("click", () => {
        currentCategory = "all";
        searchQuery = "";
        minPrice = null;
        maxPrice = null;

        searchInput.value = "";
        minPriceInput.value = "";
        maxPriceInput.value = "";

        sidebarButtons.forEach((b) => b.classList.remove("active"));
        document
          .querySelector('.category-item[data-category="all"]')
          .classList.add("active");

        applyFilters();
      });

      // ุชุทุจูู ุงูููุชุฑ ุจุงูุฅูุชุฑ ูู ุฃู ุญูู
      [searchInput, minPriceInput, maxPriceInput].forEach((el) => {
        el.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            applyFiltersBtn.click();
          }
        });
      });

      document.getElementById("year").textContent =
        new Date().getFullYear();

      document.addEventListener("DOMContentLoaded", () => {
        loadProducts();
      });
    </script>
  </body>
</html>