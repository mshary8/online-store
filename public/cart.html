<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Meshari Tech Store</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="store-body">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-nav">
      <div class="nav-left">
        <a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="login.html" class="nav-link">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        <a href="register.html" class="nav-link">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</a>
        <a href="cart.html" class="nav-link cart-link active">
          ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="cart-count">0</span>)
        </a>
      </div>
      <div class="nav-right">
        <span class="store-logo">Meshari Tech Store</span>
      </div>
    </header>

    <main class="page-container">
      <h1 class="page-title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>

      <section class="cart-wrapper">
        <div id="cartContent"></div>
      </section>
    </main>

    <script>
      // Ù†ÙØ³ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ main.js Ù„ÙƒÙ† Ù…Ø¨Ø³Ø·Ø© Ù‡Ù†Ø§

      function getCart() {
        const raw = localStorage.getItem("cart");
        return raw ? JSON.parse(raw) : [];
      }

      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function updateCartBadge() {
        const badge = document.getElementById("cart-count");
        if (!badge) return;
        const cart = getCart();
        const count = cart.reduce((sum, item) => sum + item.qty, 0);
        badge.textContent = count;
      }

      function formatPrice(p) {
        return p.toLocaleString("ar-SA", { minimumFractionDigits: 2 });
      }

      function renderCart() {
        const container = document.getElementById("cartContent");
        const cart = getCart();

        if (cart.length === 0) {
          container.innerHTML = `
            <div class="cart-empty">
              <p>Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ ğŸ›’</p>
              <a href="index.html" class="btn-primary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚</a>
            </div>
          `;
          updateCartBadge();
          return;
        }

        let total = 0;
        cart.forEach((item) => {
          total += item.price * item.qty;
        });

        let rows = cart
          .map(
            (item) => `
          <tr>
            <td>
              <div class="cart-item-main">
                <div class="cart-thumb">
                  <span>${item.name.charAt(0)}</span>
                </div>
                <div>
                  <div class="cart-item-name">${item.name}</div>
                  <div class="cart-item-meta">
                    ${item.category || ""} â€“ Ø±.Ø³ ${formatPrice(item.price)}
                  </div>
                </div>
              </div>
            </td>
            <td class="cart-qty-cell">
              <button class="qty-btn" data-id="${item.id}" data-action="dec">âˆ’</button>
              <span class="qty-value">${item.qty}</span>
              <button class="qty-btn" data-id="${item.id}" data-action="inc">+</button>
            </td>
            <td class="cart-price-cell">
              Ø±.Ø³ ${formatPrice(item.price * item.qty)}
            </td>
            <td class="cart-remove-cell">
              <button class="remove-btn" data-id="${item.id}">Ø­Ø°Ù</button>
            </td>
          </tr>
        `
          )
          .join("");

        container.innerHTML = `
          <div class="cart-card">
            <table class="cart-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                  <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                ${rows}
              </tbody>
            </table>

            <div class="cart-footer">
              <div class="cart-total">
                Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span>Ø±.Ø³ ${formatPrice(total)}</span>
              </div>
              <div class="cart-actions">
                <button id="clearCartBtn" class="btn-secondary">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
                <button id="checkoutBtn" class="btn-primary">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
              </div>
            </div>
          </div>
        `;

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙ…ÙŠØ©
        document.querySelectorAll(".qty-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = Number(btn.getAttribute("data-id"));
            const action = btn.getAttribute("data-action");
            const cart = getCart();
            const item = cart.find((i) => i.id === id);
            if (!item) return;

            if (action === "inc") item.qty += 1;
            if (action === "dec") item.qty -= 1;
            if (item.qty <= 0) {
              const idx = cart.findIndex((i) => i.id === id);
              cart.splice(idx, 1);
            }

            saveCart(cart);
            renderCart();
            updateCartBadge();
          });
        });

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
        document.querySelectorAll(".remove-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = Number(btn.getAttribute("data-id"));
            let cart = getCart();
            cart = cart.filter((i) => i.id !== id);
            saveCart(cart);
            renderCart();
            updateCartBadge();
          });
        });

        // Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
        document
          .getElementById("clearCartBtn")
          .addEventListener("click", () => {
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
            localStorage.removeItem("cart");
            renderCart();
            updateCartBadge();
          });

        // Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø©)
        document
          .getElementById("checkoutBtn")
          .addEventListener("click", () => {
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ø¨Ø´ÙƒÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ âœ… ÙŠÙ…ÙƒÙ†Ùƒ ØªØ·ÙˆÙŠØ± ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ù‹Ø§.");
          });
      }

      document.addEventListener("DOMContentLoaded", () => {
        updateCartBadge();
        renderCart();
      });
    </script>
  </body>
</html>