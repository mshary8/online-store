<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Al-Mashari Electronics</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="store-body">

  <header class="topbar">
    <div class="top-left">
      <a href="index.html" class="top-link">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</a>
    </div>
    <h1 class="store-name">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
    <div class="top-right">
      <span class="top-link">Al-Mashari Electronics</span>
    </div>
  </header>

  <main class="cart-main">
    <div id="cartContent" class="cart-card"></div>
  </main>

  <footer class="store-footer">
    &copy; 2025 Al-Mashari Electronics
  </footer>

  <script>
    function getCart() {
      try {
        return JSON.parse(localStorage.getItem("cart") || "[]");
      } catch {
        return [];
      }
    }

    function saveCart(cart) {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function updateCartBadgeOnCartPage() {
      // not needed here, but kept for future
    }

    function formatPrice(v) {
      return v.toLocaleString("ar-SA", { minimumFractionDigits: 2 });
    }

    function renderCart() {
      const container = document.getElementById("cartContent");
      const cart = getCart();

      if (!cart.length) {
        container.innerHTML = `
          <p class="empty-message">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ›’</p>
          <a href="index.html" class="btn-primary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚</a>
        `;
        return;
      }

      let total = 0;
      const rows = cart
        .map((item, idx) => {
          const sub = item.price * item.quantity;
          total += sub;
          return `
            <div class="cart-item-row">
              <div class="cart-item-info">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-meta">
                  Ø§Ù„Ø³Ø¹Ø±: ${formatPrice(item.price)} Ø±.Ø³ â€¢ Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}
                </div>
              </div>
              <div class="cart-item-actions">
                <button data-index="${idx}" data-action="dec">âˆ’</button>
                <span>${item.quantity}</span>
                <button data-index="${idx}" data-action="inc">+</button>
                <button data-index="${idx}" data-action="remove">Ø­Ø°Ù</button>
                <span class="cart-item-sub">${formatPrice(sub)} Ø±.Ø³</span>
              </div>
            </div>
          `;
        })
        .join("");

      container.innerHTML = `
        <div class="cart-items">
          ${rows}
        </div>
        <div class="cart-summary">
          <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <strong>${formatPrice(total)} Ø±.Ø³</strong></div>
          <div class="cart-summary-actions">
            <button id="clearCartBtn" class="btn-secondary">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
            <button id="checkoutBtn" class="btn-primary">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</button>
          </div>
        </div>
      `;

      container.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        const idx = Number(btn.getAttribute("data-index"));
        const action = btn.getAttribute("data-action");
        let cart = getCart();
        if (!cart[idx]) return;

        if (action === "inc") cart[idx].quantity += 1;
        if (action === "dec") cart[idx].quantity -= 1;
        if (action === "remove" || cart[idx].quantity <= 0) {
          cart.splice(idx, 1);
        }

        saveCart(cart);
        renderCart();
      });

      document.getElementById("clearCartBtn").onclick = () => {
        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
        saveCart([]);
        renderCart();
      };

      document.getElementById("checkoutBtn").onclick = () => {
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ (ØªØ¬Ø±ÙŠØ¨ÙŠ). ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹.");
      };
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderCart();
    });
  </script>
</body>
</html>